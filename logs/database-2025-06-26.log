{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.136Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.137Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.138Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.138Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.138Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.138Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.139Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T10:32:14.139Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-26T10:32:14.207Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T10:32:36.060Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:36.340Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:36.341Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:36.360Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["VM9GA1fDo2abzGFalWMs7c9r0J3OtQul",48],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:36.388Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:40.105Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT energy_type, COUNT(*) as count, SUM(value) as total_value FROM contracts WHERE status = 'accepted' GROUP BY energy_type","service":"nexus-db","timestamp":"2025-06-26T10:32:40.107Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:44.665Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-26T10:32:44.667Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:46.775Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T10:32:46.777Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:48.507Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T10:32:48.511Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:49.074Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T10:32:49.077Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:32:49.635Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T10:32:49.641Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.795Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.796Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.797Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.798Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.798Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.798Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.798Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T10:46:44.799Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-26T10:46:44.857Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T10:46:58.070Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:46:58.347Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:46:58.347Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:46:58.361Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["Sjoh2mMjr_LmSQ8Q9AXVzb2YHWwtDO1D",49],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:46:58.366Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:47:01.896Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T10:47:01.898Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:47:03.877Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-26T10:47:03.880Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T10:47:06.262Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.448Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.451Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.451Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.451Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.452Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.452Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.452Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T14:22:59.452Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-26T14:22:59.510Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T14:23:21.594Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:21.893Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:21.893Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:21.904Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:21.923Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["QfZAC8FqypUxr52oAMUVg_hGilknBzcc",50],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:21.926Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-26T14:23:21.941Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-26T14:23:21.941Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-26T14:23:21.941Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-26T14:23:21.941Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-26T14:23:21.942Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-26T14:23:21.942Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-26T14:23:21.942Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-26T14:23:21.943Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:31.179Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-26T14:23:31.180Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:33.871Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:38.625Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, eu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-26T14:23:38.628Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, gu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-26T14:23:38.629Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[15],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:38.631Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:39.629Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-26T14:23:39.631Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:40.374Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T14:23:40.375Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:40.989Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-26T14:23:40.990Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:44.725Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-26T14:23:44.725Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:46.380Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["15"],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:46.381Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:50.469Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:50.519Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:23:58.035Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:24:05.906Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T14:24:16.994Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-26T14:24:16.997Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-26T14:24:16.997Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-26T14:24:16.998Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-26T14:24:16.998Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-26T14:24:16.998Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-26T14:24:16.998Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-26T14:24:16.999Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-26T14:24:16.999Z"}
