{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.764Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.767Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.768Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.769Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.770Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.771Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.772Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-26T08:37:50.772Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-26T08:37:50.891Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T08:38:04.269Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:38:04.632Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:38:04.633Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["fAHLAdpuBHkUZoupRYdb4_1fJVrmls7T",40],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:38:04.672Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users ORDER BY created_at DESC","service":"nexus-db","timestamp":"2025-06-26T08:38:06.438Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T08:42:38.137Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:42:38.454Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:42:38.454Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["x8SuUIk21r7Dm4iYjOW4KyCMN36KhEqg",41],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:42:38.533Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users ORDER BY created_at DESC","service":"nexus-db","timestamp":"2025-06-26T08:42:43.172Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-26T08:48:36.983Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:48:37.315Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:48:37.316Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["x8E7038terGvUBnyvcUYHl-sVTGPNw5s",42],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-26T08:48:37.341Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users ORDER BY created_at DESC","service":"nexus-db","timestamp":"2025-06-26T08:48:41.629Z"}
