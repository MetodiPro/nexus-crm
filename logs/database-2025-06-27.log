{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.920Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.921Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.921Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.922Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.923Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.923Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.923Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T07:36:43.924Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T07:36:43.981Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T07:36:54.727Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:36:55.026Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:36:55.027Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:36:55.043Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:36:55.053Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["sFNxK4ldN8uiVE_jDprFLeMkRowprFm3",51],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:36:55.058Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T07:36:55.068Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T07:36:55.069Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T07:36:55.069Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T07:36:55.069Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T07:36:55.070Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T07:36:55.070Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T07:36:55.070Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T07:36:55.071Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:37:02.653Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T07:37:02.655Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:37:03.318Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T07:37:03.319Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:37:09.804Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:37:09.884Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:37:14.875Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:39:00.323Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:39:05.537Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:41:51.781Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T07:41:51.791Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.944Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.945Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.946Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.946Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.947Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.947Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.947Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T07:43:15.948Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T07:43:16.005Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T07:43:25.541Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:25.812Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:25.813Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:25.842Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:25.853Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["jNkBdGj-6-02UpxYgySQgZr7qhZbfzWW",52],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:25.856Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T07:43:25.866Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T07:43:25.867Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T07:43:25.867Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T07:43:25.868Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T07:43:25.868Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T07:43:25.868Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T07:43:25.869Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T07:43:25.869Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:29.711Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:29.774Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:32.300Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T07:43:35.076Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.775Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.776Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.777Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.777Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.777Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.777Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.778Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:05:01.778Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T08:05:01.836Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.955Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.956Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.957Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.957Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.957Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.958Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.958Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:06:57.958Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T08:06:58.014Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T08:07:10.980Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:11.286Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:11.287Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:11.295Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:11.309Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T08:07:11.311Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T08:07:11.312Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T08:07:11.312Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T08:07:11.312Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T08:07:11.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T08:07:11.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T08:07:11.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T08:07:11.313Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["K4u-F08BXastYY58jOcIDK5hPQlNOHGg",53],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:11.380Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:13.100Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:13.778Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:22.266Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:07:30.077Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.859Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.861Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.861Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.862Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.862Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.862Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.862Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T08:15:35.862Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T08:15:35.924Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T08:15:43.962Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:44.279Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:44.280Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:44.304Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:44.310Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T08:15:44.312Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T08:15:44.312Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T08:15:44.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T08:15:44.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T08:15:44.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T08:15:44.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T08:15:44.313Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T08:15:44.314Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["6TQ6pfZix1KsxostuMDh-bRioZfJHI0_",54],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:44.343Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:49.021Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T08:15:49.023Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:54.600Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T08:15:54.602Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:15:56.570Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T08:15:56.571Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T08:15:56.572Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:16:02.921Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, eu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T08:16:02.924Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, gu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T08:16:02.925Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[15],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:16:02.927Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:16:05.389Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T08:16:05.393Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:16:07.745Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:34:17.956Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T08:34:17.978Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T08:34:21.499Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T08:34:21.500Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T08:34:21.503Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, c.company, u.name as consultant_name, u.email as consultant_email FROM contracts co JOIN clients c ON co.client_id = c.id JOIN users u ON c.consultant_id = u.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') AND co.expiry_notification_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T09:00:00.379Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname, c.company, c.phone as client_phone, c.email as client_email, c.address as client_address, c.city as client_city, u.name as consultant_name, u.email as consultant_email FROM activities a JOIN clients c ON a.client_id = c.id JOIN users u ON a.consultant_id = u.id WHERE a.status = 'pending' AND date(a.activity_date) BETWEEN date('now') AND date('now', '+1 days') AND a.reminder_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T09:00:00.417Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.237Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.238Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.238Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.239Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.239Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.239Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.239Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:37:17.239Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T09:37:17.294Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T09:37:37.690Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:37.988Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:37.988Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:38.006Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["eDE4MuCr_u0AYFqqfxT_eayWew_AISxR",55],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:38.009Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:38.020Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:37:38.023Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:37:38.023Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:37:38.023Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:37:38.023Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:37:38.024Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:37:38.024Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:37:38.024Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:37:38.024Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:46.091Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:37:46.095Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:46.702Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:37:46.705Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:48.931Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:37:48.932Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:58.440Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["4"],"query":"SELECT p.*, u.name as created_by_name FROM products p LEFT JOIN users u ON p.created_by = u.id WHERE p.id = ?","service":"nexus-db","timestamp":"2025-06-27T09:37:58.441Z"}
{"level":"debug","message":"Database query executed","method":"all","params":["4"],"query":"SELECT * FROM product_attachments WHERE product_id = ? ORDER BY upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:37:58.442Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:13.332Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT pa.*, p.name as product_name, u.name as uploaded_by_name FROM product_attachments pa JOIN products p ON pa.product_id = p.id LEFT JOIN users u ON pa.uploaded_by = u.id ORDER BY pa.upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:38:13.333Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:16.199Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:23.584Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:38:23.585Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:25.431Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:32.117Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:39.134Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:40.235Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:44.459Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.contract_end_date IS NOT NULL AND eu.contract_end_date <= date('now', '+90 days') AND eu.contract_end_date >= date('now') AND eu.is_active = 1 ORDER BY eu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:38:44.460Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.contract_end_date IS NOT NULL AND gu.contract_end_date <= date('now', '+90 days') AND gu.contract_end_date >= date('now') AND gu.is_active = 1 ORDER BY gu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:38:44.462Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:46.317Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:46.322Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:38:46.323Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:38:46.323Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:38:46.324Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:38:46.324Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:38:46.324Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:38:46.324Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:38:46.325Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:38:46.325Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:53.065Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:38:53.066Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:38:55.240Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:38:55.241Z"}
{"error":"SQLITE_ERROR: no such column: p.supplier","level":"error","message":"Database all error","params":[],"query":"\n      SELECT co.*, c.name as client_name, c.surname as client_surname, \n             p.name as product_name, p.supplier as product_supplier\n      FROM contracts co\n      JOIN clients c ON co.client_id = c.id\n      LEFT JOIN products p ON co.product_id = p.id\n     ORDER BY co.created_at DESC","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: p.supplier\n--> in Database#all('\\n' +\n  '      SELECT co.*, c.name as client_name, c.surname as client_surname, \\n' +\n  '             p.name as product_name, p.supplier as product_supplier\\n' +\n  '      FROM contracts co\\n' +\n  '      JOIN clients c ON co.client_id = c.id\\n' +\n  '      LEFT JOIN products p ON co.product_id = p.id\\n' +\n  '     ORDER BY co.created_at DESC', [], [Function (anonymous)])\n    at Database.all (C:\\progetti\\nexus-crm\\middleware\\logging.js:115:27)\n    at Contract.getAll (C:\\progetti\\nexus-crm\\models\\contract.js:23:8)\n    at C:\\progetti\\nexus-crm\\routes\\contracts.js:13:12\n    at Layer.handle [as handle_request] (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\index.js:346:12)","timestamp":"2025-06-27T09:38:55.243Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.454Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.455Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.456Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.456Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.457Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.457Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.457Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:40:06.457Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T09:40:06.509Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T09:40:18.558Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:18.843Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:18.844Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:18.852Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:18.904Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:40:18.906Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:40:18.907Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:40:18.907Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:40:18.907Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:40:18.908Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:40:18.908Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:40:18.909Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:40:18.909Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["EcdgBFZFK7HzpDxs6vROGt4kGDA7wrh0",56],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:18.958Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:21.248Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:21.250Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:23.115Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, eu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:23.117Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, gu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:23.118Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[15],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:23.119Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:24.533Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:24.534Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:27.066Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT pa.*, p.name as product_name, u.name as uploaded_by_name FROM product_attachments pa JOIN products p ON pa.product_id = p.id LEFT JOIN users u ON pa.uploaded_by = u.id ORDER BY pa.upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:40:27.067Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:29.228Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:40:29.229Z"}
{"error":"SQLITE_ERROR: no such column: p.supplier","level":"error","message":"Database all error","params":[],"query":"\n      SELECT co.*, c.name as client_name, c.surname as client_surname, \n             p.name as product_name, p.supplier as product_supplier\n      FROM contracts co\n      JOIN clients c ON co.client_id = c.id\n      LEFT JOIN products p ON co.product_id = p.id\n     ORDER BY co.created_at DESC","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: p.supplier\n--> in Database#all('\\n' +\n  '      SELECT co.*, c.name as client_name, c.surname as client_surname, \\n' +\n  '             p.name as product_name, p.supplier as product_supplier\\n' +\n  '      FROM contracts co\\n' +\n  '      JOIN clients c ON co.client_id = c.id\\n' +\n  '      LEFT JOIN products p ON co.product_id = p.id\\n' +\n  '     ORDER BY co.created_at DESC', [], [Function (anonymous)])\n    at Database.all (C:\\progetti\\nexus-crm\\middleware\\logging.js:115:27)\n    at Contract.getAll (C:\\progetti\\nexus-crm\\models\\contract.js:23:8)\n    at C:\\progetti\\nexus-crm\\routes\\contracts.js:13:12\n    at Layer.handle [as handle_request] (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (C:\\progetti\\nexus-crm\\node_modules\\express\\lib\\router\\index.js:346:12)","timestamp":"2025-06-27T09:40:29.230Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:32.827Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.contract_end_date IS NOT NULL AND eu.contract_end_date <= date('now', '+90 days') AND eu.contract_end_date >= date('now') AND eu.is_active = 1 ORDER BY eu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:32.828Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.contract_end_date IS NOT NULL AND gu.contract_end_date <= date('now', '+90 days') AND gu.contract_end_date >= date('now') AND gu.is_active = 1 ORDER BY gu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:32.829Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:34.656Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:34.661Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:40:34.661Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:40:34.662Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:40:34.662Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:40:34.662Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:40:34.662Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:40:34.663Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:40:34.663Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:40:34.663Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:36.347Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id ORDER BY a.activity_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:40:36.349Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:37.354Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:37.361Z"}
{"level":"debug","message":"Database query executed","method":"all","params":["2025-06-27"],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE date(a.activity_date) = date(?) ORDER BY a.activity_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:40:37.365Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:38.928Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT energy_type, COUNT(*) as count, SUM(value) as total_value FROM contracts WHERE status = 'accepted' GROUP BY energy_type","service":"nexus-db","timestamp":"2025-06-27T09:40:38.929Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:40.014Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:42.589Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:43.975Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:45.454Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:46.650Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:40:54.035Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.507Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.508Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.509Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.509Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.509Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.509Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.509Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T09:46:39.510Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T09:46:39.566Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T09:47:25.403Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:25.728Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:25.729Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:25.752Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:25.775Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:47:25.778Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:47:25.779Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:47:25.780Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:47:25.780Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:47:25.780Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:47:25.781Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:47:25.781Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:47:25.781Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["H12olIiJThM3VeWAlD1b2ZXbPQJ_iwWi",57],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:25.839Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:28.255Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:28.256Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:30.101Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, eu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:30.104Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, gu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:30.105Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[15],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:30.106Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:30.786Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:30.787Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:33.983Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT pa.*, p.name as product_name, u.name as uploaded_by_name FROM product_attachments pa JOIN products p ON pa.product_id = p.id LEFT JOIN users u ON pa.uploaded_by = u.id ORDER BY pa.upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:47:33.985Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:35.090Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:47:35.091Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:37.847Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.contract_end_date IS NOT NULL AND eu.contract_end_date <= date('now', '+90 days') AND eu.contract_end_date >= date('now') AND eu.is_active = 1 ORDER BY eu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:37.849Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company, c.phone, c.email FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.contract_end_date IS NOT NULL AND gu.contract_end_date <= date('now', '+90 days') AND gu.contract_end_date >= date('now') AND gu.is_active = 1 ORDER BY gu.contract_end_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:37.850Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:39.411Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:39.418Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:47:39.420Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:47:39.421Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:47:39.421Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:47:39.421Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:47:39.421Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:47:39.422Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:47:39.422Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:47:39.422Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:40.230Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:47:40.231Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:41.710Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:41.711Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:41.712Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:57.904Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id ORDER BY a.activity_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:47:57.905Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:47:59.987Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:47:59.988Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:05.445Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:05.451Z"}
{"level":"debug","message":"Database query executed","method":"all","params":["2025-06-27"],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE date(a.activity_date) = date(?) ORDER BY a.activity_date ASC","service":"nexus-db","timestamp":"2025-06-27T09:48:05.452Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:07.458Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT energy_type, COUNT(*) as count, SUM(value) as total_value FROM contracts WHERE status = 'accepted' GROUP BY energy_type","service":"nexus-db","timestamp":"2025-06-27T09:48:07.459Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:08.713Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT notification_contracts, notification_activities, notification_digest, email FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:08.714Z"}
{"error":"SQLITE_ERROR: no such column: notification_contracts","level":"error","message":"Database get error","params":[1],"query":"\n        SELECT notification_contracts, notification_activities, notification_digest, email\n        FROM users \n        WHERE id = ?\n      ","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: notification_contracts","timestamp":"2025-06-27T09:48:08.715Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:19.775Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users ORDER BY created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:48:19.777Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:22.716Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T09:48:22.717Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:48:22.717Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T09:48:22.717Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T09:48:22.717Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count, COALESCE(SUM(value), 0) as total_value FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:48:22.718Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T09:48:22.718Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:48:22.718Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T09:48:22.718Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:29.386Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:48:29.387Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:48:31.803Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:48:31.803Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T09:48:31.804Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:18.763Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T09:55:18.780Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:23.382Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT pa.*, p.name as product_name, u.name as uploaded_by_name FROM product_attachments pa JOIN products p ON pa.product_id = p.id LEFT JOIN users u ON pa.uploaded_by = u.id ORDER BY pa.upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T09:55:23.388Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:26.978Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:55:26.979Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:30.066Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:55:30.068Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T09:55:30.070Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:32.358Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:55:32.359Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:38.470Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT energy_type, COUNT(*) as count, SUM(value) as total_value FROM contracts WHERE status = 'accepted' GROUP BY energy_type","service":"nexus-db","timestamp":"2025-06-27T09:55:38.471Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:42.069Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T09:55:42.070Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T09:55:44.021Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T09:55:44.021Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T09:55:44.022Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, c.company, u.name as consultant_name, u.email as consultant_email FROM contracts co JOIN clients c ON co.client_id = c.id JOIN users u ON c.consultant_id = u.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') AND co.expiry_notification_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T10:00:00.043Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname, c.company, c.phone as client_phone, c.email as client_email, c.address as client_address, c.city as client_city, u.name as consultant_name, u.email as consultant_email FROM activities a JOIN clients c ON a.client_id = c.id JOIN users u ON a.consultant_id = u.id WHERE a.status = 'pending' AND date(a.activity_date) BETWEEN date('now') AND date('now', '+1 days') AND a.reminder_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T10:00:00.046Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:07:17.180Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T10:07:17.183Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:08:19.289Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T10:08:19.290Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T10:08:19.291Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS users ( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT UNIQUE NOT NULL, password TEXT NOT NULL, role TEXT NOT NULL, name TEXT NOT NULL, email TEXT, last_login DATETIME, failed_login_attempts INTEGER DEFAULT 0, account_locked BOOLEAN DEFAULT 0, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.467Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS clients ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, surname TEXT NOT NULL, company TEXT, vat_number TEXT, address TEXT, city TEXT, postal_code TEXT, phone TEXT, email TEXT, notes TEXT, consultant_id INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.468Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS activities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, title TEXT NOT NULL, description TEXT, activity_date DATETIME NOT NULL, status TEXT DEFAULT 'pending', consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.468Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS products ( id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, description TEXT, energy_type TEXT NOT NULL, supplier TEXT, base_price REAL, is_active INTEGER DEFAULT 1, created_by INTEGER, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (created_by) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.468Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS contracts ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, product_id INTEGER, contract_type TEXT NOT NULL, energy_type TEXT NOT NULL, supplier TEXT, status TEXT DEFAULT 'pending', value REAL, start_date DATE, end_date DATE, notes TEXT, consultant_id INTEGER NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id), FOREIGN KEY (product_id) REFERENCES products (id), FOREIGN KEY (consultant_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.468Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS user_sessions ( id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER NOT NULL, session_id TEXT NOT NULL, ip_address TEXT, user_agent TEXT, login_time DATETIME DEFAULT CURRENT_TIMESTAMP, logout_time DATETIME, is_active BOOLEAN DEFAULT 1, FOREIGN KEY (user_id) REFERENCES users (id) )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.468Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS electricity_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pod_code TEXT NOT NULL, utility_name TEXT, power_kw REAL, voltage TEXT CHECK(voltage IN ('BT', 'MT', 'AT')), meter_type TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_kwh INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.469Z"}
{"level":"debug","message":"Database query executed","method":"run","query":"CREATE TABLE IF NOT EXISTS gas_utilities ( id INTEGER PRIMARY KEY AUTOINCREMENT, client_id INTEGER NOT NULL, pdr_code TEXT NOT NULL, utility_name TEXT, meter_type TEXT, remi_code TEXT, supplier TEXT, contract_start_date DATE, contract_end_date DATE, last_bill_date DATE, annual_consumption_smc INTEGER, annual_consumption_year INTEGER, utility_address TEXT, utility_city TEXT, utility_postal_code TEXT, utility_province TEXT, notes TEXT, is_active BOOLEAN DEFAULT 1, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (client_id) REFERENCES clients (id) ON DELETE CASCADE )","service":"nexus-db","timestamp":"2025-06-27T10:18:23.469Z"}
{"level":"debug","message":"Database query executed","method":"get","query":"SELECT * FROM users WHERE username = 'admin'","service":"nexus-db","timestamp":"2025-06-27T10:18:23.524Z"}
{"level":"debug","message":"Database query executed","method":"get","params":["admin"],"query":"SELECT * FROM users WHERE LOWER(username) = LOWER(?)","service":"nexus-db","timestamp":"2025-06-27T10:18:34.667Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET failed_login_attempts = 0, account_locked = 0 WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:34.967Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[1],"query":"UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:34.968Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:34.983Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:34.995Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T10:18:34.998Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T10:18:34.999Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T10:18:34.999Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T10:18:35.000Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT service_type, COUNT(*) as count, COUNT(CASE WHEN is_active = 1 THEN 1 END) as active_count FROM products GROUP BY service_type","service":"nexus-db","timestamp":"2025-06-27T10:18:35.000Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:18:35.000Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:18:35.000Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as products_count FROM products WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:18:35.001Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:18:35.001Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:18:35.001Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT service_type, COUNT(*) as total, COUNT(CASE WHEN is_active = 1 THEN 1 END) as active FROM products GROUP BY service_type","service":"nexus-db","timestamp":"2025-06-27T10:18:35.001Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT p.name, p.service_type, COUNT(c.id) as usage_count FROM products p LEFT JOIN contracts c ON p.id = c.product_id WHERE p.is_active = 1 GROUP BY p.id ORDER BY usage_count DESC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:18:35.002Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT COUNT(*) as total_attachments, COUNT(DISTINCT product_id) as products_with_attachments FROM product_attachments","service":"nexus-db","timestamp":"2025-06-27T10:18:35.002Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT supplier_operator, COUNT(*) as count FROM products WHERE is_active = 1 AND supplier_operator IS NOT NULL GROUP BY supplier_operator ORDER BY count DESC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:18:35.002Z"}
{"level":"debug","message":"Database query executed","method":"run","params":["FTt9kqkvNxv1bmuBkMfFXkdKb9He64TR",58],"query":"UPDATE user_sessions SET session_id = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:35.067Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:38.980Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T10:18:38.981Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:42.460Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:18:42.461Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:44.055Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, p.name as product_name, p.supplier_operator as product_supplier FROM contracts co JOIN clients c ON co.client_id = c.id LEFT JOIN products p ON co.product_id = p.id ORDER BY co.created_at DESC","service":"nexus-db","timestamp":"2025-06-27T10:18:44.056Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:45.678Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T10:18:45.680Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT * FROM products WHERE is_active = 1 ORDER BY name ASC","service":"nexus-db","timestamp":"2025-06-27T10:18:45.682Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:53.972Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id ORDER BY a.activity_date DESC","service":"nexus-db","timestamp":"2025-06-27T10:18:53.974Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:55.177Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:55.184Z"}
{"level":"debug","message":"Database query executed","method":"all","params":["2025-06-27"],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE date(a.activity_date) = date(?) ORDER BY a.activity_date ASC","service":"nexus-db","timestamp":"2025-06-27T10:18:55.186Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:56.125Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT energy_type, COUNT(*) as count, SUM(value) as total_value FROM contracts WHERE status = 'accepted' GROUP BY energy_type","service":"nexus-db","timestamp":"2025-06-27T10:18:56.127Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:56.934Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT notification_contracts, notification_activities, notification_digest, email FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:56.935Z"}
{"error":"SQLITE_ERROR: no such column: notification_contracts","level":"error","message":"Database get error","params":[1],"query":"\n        SELECT notification_contracts, notification_activities, notification_digest, email\n        FROM users \n        WHERE id = ?\n      ","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: notification_contracts","timestamp":"2025-06-27T10:18:56.936Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:57.449Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:18:58.418Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users ORDER BY created_at DESC","service":"nexus-db","timestamp":"2025-06-27T10:18:58.419Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:39.104Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:40.136Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:47.194Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:53.169Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:56.483Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT notification_contracts, notification_activities, notification_digest, email FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:38:56.484Z"}
{"error":"SQLITE_ERROR: no such column: notification_contracts","level":"error","message":"Database get error","params":[1],"query":"\n        SELECT notification_contracts, notification_activities, notification_digest, email\n        FROM users \n        WHERE id = ?\n      ","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: notification_contracts","timestamp":"2025-06-27T10:38:56.487Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:39:02.159Z"}
{"level":"debug","message":"Database query executed","method":"run","params":[0,0,0,1],"query":"UPDATE users SET notification_contracts = ?, notification_activities = ?, notification_digest = ? WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:39:02.161Z"}
{"error":"SQLITE_ERROR: no such column: notification_contracts","level":"error","message":"Database run error","params":[0,0,0,1],"query":"\n      UPDATE users \n      SET notification_contracts = ?, \n          notification_activities = ?, \n          notification_digest = ?\n      WHERE id = ?\n    ","service":"nexus-db","stack":"Error: SQLITE_ERROR: no such column: notification_contracts","timestamp":"2025-06-27T10:39:02.162Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:39:09.974Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT client_status, COUNT(*) as count FROM clients GROUP BY client_status","service":"nexus-db","timestamp":"2025-06-27T10:39:09.975Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM contracts WHERE strftime('%Y', created_at) = strftime('%Y', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T10:39:09.977Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT status, COUNT(*) as count FROM activities WHERE strftime('%Y-%m', created_at) = strftime('%Y-%m', 'now') GROUP BY status","service":"nexus-db","timestamp":"2025-06-27T10:39:09.977Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT 'electricity' as type, COUNT(*) as count FROM electricity_utilities WHERE is_active = 1 UNION ALL SELECT 'gas' as type, COUNT(*) as count FROM gas_utilities WHERE is_active = 1","service":"nexus-db","timestamp":"2025-06-27T10:39:09.977Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT service_type, COUNT(*) as count, COUNT(CASE WHEN is_active = 1 THEN 1 END) as active_count FROM products GROUP BY service_type","service":"nexus-db","timestamp":"2025-06-27T10:39:09.977Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as contracts_count FROM contracts WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:39:09.978Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as clients_count FROM clients WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT strftime('%Y-%m', created_at) as month, COUNT(*) as products_count FROM products WHERE created_at >= date('now', '-12 months') GROUP BY month ORDER BY month","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname FROM activities a JOIN clients c ON a.client_id = c.id WHERE a.status = 'pending' AND a.activity_date BETWEEN date('now') AND date('now', '+7 days') ORDER BY a.activity_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname FROM contracts co JOIN clients c ON co.client_id = c.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') ORDER BY co.end_date ASC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT service_type, COUNT(*) as total, COUNT(CASE WHEN is_active = 1 THEN 1 END) as active FROM products GROUP BY service_type","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT p.name, p.service_type, COUNT(c.id) as usage_count FROM products p LEFT JOIN contracts c ON p.id = c.product_id WHERE p.is_active = 1 GROUP BY p.id ORDER BY usage_count DESC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT COUNT(*) as total_attachments, COUNT(DISTINCT product_id) as products_with_attachments FROM product_attachments","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT supplier_operator, COUNT(*) as count FROM products WHERE is_active = 1 AND supplier_operator IS NOT NULL GROUP BY supplier_operator ORDER BY count DESC LIMIT 10","service":"nexus-db","timestamp":"2025-06-27T10:39:09.979Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:16.339Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT id, name, surname, company, vat_number, fiscal_code, company_fiscal_code, phone, email, pec_email, city, province, client_status, last_contact_date, created_at FROM clients ORDER BY name ASC, surname ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:16.344Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:18.026Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:47.310Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT eu.*, c.name as client_name, c.surname as client_surname, c.company FROM electricity_utilities eu JOIN clients c ON eu.client_id = c.id WHERE eu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, eu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:47.316Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT gu.*, c.name as client_name, c.surname as client_surname, c.company FROM gas_utilities gu JOIN clients c ON gu.client_id = c.id WHERE gu.is_active = 1 ORDER BY c.name ASC, c.surname ASC, gu.utility_name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:47.317Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[15],"query":"SELECT * FROM clients WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:47.320Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:49.127Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:49.129Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:49.872Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:49.873Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:50.817Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:50.818Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:51.362Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:51.363Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:52.262Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:52.263Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:52.885Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT p.*, u.name as created_by_name, COUNT(pa.id) as attachments_count FROM products p LEFT JOIN users u ON p.created_by = u.id LEFT JOIN product_attachments pa ON p.id = pa.product_id GROUP BY p.id ORDER BY p.name ASC","service":"nexus-db","timestamp":"2025-06-27T10:40:52.886Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:54.794Z"}
{"level":"debug","message":"Database query executed","method":"all","query":"SELECT pa.*, p.name as product_name, u.name as uploaded_by_name FROM product_attachments pa JOIN products p ON pa.product_id = p.id LEFT JOIN users u ON pa.uploaded_by = u.id ORDER BY pa.upload_date DESC","service":"nexus-db","timestamp":"2025-06-27T10:40:54.796Z"}
{"level":"debug","message":"Database query executed","method":"get","params":[1],"query":"SELECT id, username, role, name, email, last_login, failed_login_attempts, account_locked, created_at FROM users WHERE id = ?","service":"nexus-db","timestamp":"2025-06-27T10:40:58.650Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT co.*, c.name as client_name, c.surname as client_surname, c.company, u.name as consultant_name, u.email as consultant_email FROM contracts co JOIN clients c ON co.client_id = c.id JOIN users u ON c.consultant_id = u.id WHERE co.status = 'accepted' AND co.end_date BETWEEN date('now') AND date('now', '+30 days') AND co.expiry_notification_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T11:00:00.285Z"}
{"level":"debug","message":"Database query executed","method":"all","params":[],"query":"SELECT a.*, c.name as client_name, c.surname as client_surname, c.company, c.phone as client_phone, c.email as client_email, c.address as client_address, c.city as client_city, u.name as consultant_name, u.email as consultant_email FROM activities a JOIN clients c ON a.client_id = c.id JOIN users u ON a.consultant_id = u.id WHERE a.status = 'pending' AND date(a.activity_date) BETWEEN date('now') AND date('now', '+1 days') AND a.reminder_sent IS NULL","service":"nexus-db","timestamp":"2025-06-27T11:00:00.293Z"}
